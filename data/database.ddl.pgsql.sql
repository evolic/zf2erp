CREATE TABLE companies (
  id SERIAL NOT NULL,
  country_id INT DEFAULT NULL,

  name VARCHAR(127) NOT NULL,
  city VARCHAR(63) NOT NULL,
  postcode VARCHAR(7) NOT NULL,
  address VARCHAR(63) NOT NULL,
  vatin VARCHAR(31) NOT NULL,
  ein VARCHAR(31) NOT NULL,
  bein VARCHAR(31) DEFAULT NULL,

  PRIMARY KEY(id)
);
CREATE INDEX IDX_8244AA3AF92F3E70 ON companies (country_id);

CREATE TABLE countries (
  id SERIAL NOT NULL,

  name VARCHAR(63) NOT NULL,

  PRIMARY KEY(id)
);

CREATE TABLE products (
  id SERIAL NOT NULL,
  category_id INT DEFAULT NULL,
  unit_id INT DEFAULT NULL,
  vat_rate_id INT DEFAULT NULL,

  name VARCHAR(64) NOT NULL,
  code VARCHAR(8) NOT NULL,
  price_netto DOUBLE PRECISION NOT NULL,
  price_brutto DOUBLE PRECISION NOT NULL,
  description TEXT NOT NULL,
  created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
  updated_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
  deleted_at TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL,

  PRIMARY KEY(id)
);
CREATE INDEX IDX_B3BA5A5A12469DE2 ON products (category_id);
CREATE INDEX IDX_B3BA5A5AF8BD700D ON products (unit_id);
CREATE INDEX IDX_B3BA5A5A43897540 ON products (vat_rate_id);
CREATE UNIQUE INDEX products_unique_code_idx ON products (code);

CREATE TABLE product_suppliers (
  product_id INT NOT NULL,
  company_id INT NOT NULL,

  PRIMARY KEY(product_id, company_id)
);
CREATE INDEX IDX_C2880FD14584665A ON product_suppliers (product_id);
CREATE INDEX IDX_C2880FD1979B1AD6 ON product_suppliers (company_id);

CREATE TABLE countries_translations (
  id INT NOT NULL,

  locale VARCHAR(8) NOT NULL,
  object_class VARCHAR(255) NOT NULL,
  field VARCHAR(32) NOT NULL,
  foreign_key INT NOT NULL,
  content TEXT DEFAULT NULL,

  PRIMARY KEY(id)
);
CREATE INDEX countries_translations_idx ON countries_translations (locale, object_class, field, foreign_key);

CREATE TABLE product_categories (
  id SERIAL NOT NULL,

  name VARCHAR(63) NOT NULL,

  PRIMARY KEY(id)
);

CREATE TABLE units (
  id SERIAL NOT NULL,

  name VARCHAR(15) NOT NULL,
  description VARCHAR(63) DEFAULT NULL,

  PRIMARY KEY(id)
);

CREATE TABLE vat_rates (
  id SERIAL NOT NULL,
  value DOUBLE PRECISION NOT NULL,

  PRIMARY KEY(id)
);

-- Sequences
CREATE SEQUENCE countries_translations_id_seq INCREMENT BY 1 MINVALUE 1 START 1;

-- Foreign Keys
ALTER TABLE companies ADD CONSTRAINT FK_8244AA3AF92F3E70 FOREIGN KEY (country_id)
REFERENCES countries (id) NOT DEFERRABLE INITIALLY IMMEDIATE;

ALTER TABLE products ADD CONSTRAINT FK_B3BA5A5A12469DE2 FOREIGN KEY (category_id)
  REFERENCES product_categories (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE products ADD CONSTRAINT FK_B3BA5A5AF8BD700D FOREIGN KEY (unit_id)
  REFERENCES units (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE products ADD CONSTRAINT FK_B3BA5A5A43897540 FOREIGN KEY (vat_rate_id)
  REFERENCES vat_rates (id) NOT DEFERRABLE INITIALLY IMMEDIATE;

ALTER TABLE product_suppliers ADD CONSTRAINT FK_C2880FD14584665A FOREIGN KEY (product_id)
  REFERENCES products (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE product_suppliers ADD CONSTRAINT FK_C2880FD1979B1AD6 FOREIGN KEY (company_id)
  REFERENCES companies (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
